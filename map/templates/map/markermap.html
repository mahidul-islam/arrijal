{% extends 'abstractbase.html' %}
{% load static %}
{% block pageStyle %}
<link rel="stylesheet" href="{% static 'map/css/map.css' %}"/>
{% endblock pageStyle %}

{% block map %}

<div class="base">
  <svg id="svg_map" width="960" height="600"></svg>
  <div class="container pt-3">
    <h4>Map of World with Marker</h4>
  </div>
</div>

{% endblock map %}

{% block pageSpecificJavascript %}

<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://d3js.org/topojson.v0.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

<script>

var cities=[
  {"code":"ZNZ", "city":"ZANZIBAR", "country":"TANZANIA", "lat":-6.13, "lon":39.31},
  {"code":"TYO", "city":"TOKYO", "country":"JAPAN", "lat":35.68, "lon":139.76},
  {"code":"AKL", "city":"AUCKLAND", "country":"NEW ZEALAND", "lat":-36.85, "lon":174.78},
  {"code":"BKK", "city":"BANGKOK", "country":"THAILAND", "lat":13.75, "lon":100.48},
  {"code":"DEL", "city":"DELHI", "country":"INDIA", "lat":29.01, "lon":77.38},
  {"code":"SIN", "city":"SINGAPORE", "country":"SINGAPOR", "lat":1.36, "lon":103.75},
  {"code":"BSB", "city":"BRASILIA", "country":"BRAZIL", "lat":-15.67, "lon":-47.43},
  {"code":"RIO", "city":"RIO DE JANEIRO", "country":"BRAZIL", "lat":-22.9, "lon":-43.24},
  {"code":"YTO", "city":"TORONTO", "country":"CANADA", "lat":43.64, "lon":-79.4},
  {"code":"IPC", "city":"EASTER ISLAND", "country":"CHILE", "lat":-27.11, "lon":-109.36},
  {"code":"SEA", "city":"SEATTLE", "country":"USA", "lat":47.61, "lon":-122.33},
  {"code":"LON", "city":"LONDON", "country":"UK", "lat":51.5072, "lon":-0.1275}
];

// var projection = d3.geo.mercator()
//     .center([50, 10]) //long and lat starting position
//     .scale(150) //starting zoom position
//     .rotate([10,0]); //where world split occurs

var projection = d3.geo.mercator()
        // .scale(width / 2 / Math.PI)
        // .translate([width / 2, height / 2])

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

var path = d3.geo.path()
    .projection(projection);
var g = svg.append("g");

// load and display the world and locations
d3.json("https://gist.githubusercontent.com/d3noob/5193723/raw/world-110m2.json", function(error, topology) {

var world = g.selectAll("path")
				.data(topojson.object(topology, topology.objects.countries).geometries)
				.enter()
				.append("path")
				.attr("d", path)

// add city location circles
var locations = g.selectAll("circle")
			       .data(cities)
			       .enter()
			       .append("circle")
			       .attr("cx", function(d) {return projection([d.lon, d.lat])[0];})
			       .attr("cy", function(d) {return projection([d.lon, d.lat])[1];})
			       .attr("r", 5)
			       .style("fill", "red")
			       .style("opacity", 0.6)
			       
});

//zoom and pan functionality
var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("path")
            .attr("d", path.projection(projection));
  });
svg.call(zoom);

</script>

{% endblock pageSpecificJavascript %}
