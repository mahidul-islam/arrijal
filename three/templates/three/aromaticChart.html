{% extends 'abstractbase.html' %}
{% load static %}
{% block css %}{% endblock css %}

{% block pageStyle %}
  <link rel="stylesheet" href="{% static 'three/css/animation.css' %}"/>
{% endblock pageStyle %}

{% block animation %}
  <div id="container"></div>
  <div id="back-button">
    <a style="text-decoration: none; color: #FFFFFF" href="{% url 'three:three' %}">Back</a>
  </div>
  <div id="menu"></div>
{% endblock %}

{% block javascript %}{% endblock javascript %}

{% block pageSpecificJavascript %}
<script type="module">
import * as THREE from 'https://threejsfundamentals.org/threejs/resources/threejs/r115/build/three.module.js';
import {GUI} from 'https://threejsfundamentals.org/threejs/../3rdparty/dat.gui.module.js';
import {OrbitControls} from 'https://threejsfundamentals.org/threejs/resources/threejs/r115/examples/jsm/controls/OrbitControls.js';
import {PDBLoader} from 'https://threejsfundamentals.org/threejs/resources/threejs/r115/examples/jsm/loaders/PDBLoader.js';
import { CSS2DRenderer, CSS2DObject } from 'https://threejsfundamentals.org/threejs/resources/threejs/r115/examples/jsm/renderers/CSS2DRenderer.js';
import {TrackballControls} from 'https://threejsfundamentals.org/threejs/resources/threejs/r115/examples/jsm/controls/TrackballControls.js';


  var camera, scene, renderer, labelRenderer;
  var controls;
  const objects = [];

  var loader = new PDBLoader();
  var offset = new THREE.Vector3();

  init();

  const base = new THREE.Group();
  scene.add( base );

  const text = {% include "three/molecules.json" %}
  const mol = JSON.parse(JSON.stringify(text))

  for (let i=0;i<mol.molecules.length;i++){
    const url = mol.molecules[i].url
    const name = mol.molecules[i].name
    const place = new THREE.Group()
    base.add(place)
    place.position.x = mol.molecules[i].positionX
    place.position.y = mol.molecules[i].positionY
    place.position.z = mol.molecules[i].positionZ
    loadMolecule( url, place, name )
  }

  for (let i=0;i<mol.links.length;i++){
    const fromMol = mol.links[i].from
    const toMol = mol.links[i].to
    const placeFrom = new THREE.Group()
    const placeTo = new THREE.Group()

    for (let i=0;i<mol.molecules.length;i++){
      if(mol.molecules[i].name == fromMol){
        placeFrom.position.x = mol.molecules[i].positionX
        placeFrom.position.y = mol.molecules[i].positionY
        placeFrom.position.z = mol.molecules[i].positionZ
      }
      if(mol.molecules[i].name == toMol){
        placeTo.position.x = mol.molecules[i].positionX
        placeTo.position.y = mol.molecules[i].positionY
        placeTo.position.z = mol.molecules[i].positionZ
      }
    }

    drawArrow(placeFrom, placeTo)
  }

  // drawArrow(place, place2)
  // drawArrow(place2, place)
  // drawArrow(place3, place)
  animate();

  // init function
  {% include 'three/sceneCameraLight.js' %}

  // drawArrow function
  {% include 'three/drawArrow.js' %}

  // loadMolecule function
  {% include 'three/loadMolecule.js' %}

  // drawPlus function
  {% include 'three/drawPlus.js' %}

  // drawEqual function
  {% include 'three/drawEqual.js' %}

  // animation all
  {% include 'three/animate.js' %}


</script>
{% endblock pageSpecificJavascript %}
